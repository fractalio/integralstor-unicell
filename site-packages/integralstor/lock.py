import os


def get_lock(name):
    """Used as a soft way to signal to others that this file is in use."""
    ret = False
    try:
        pid = str(os.getpid())
        pidfile = '/tmp/integralstor_%s_lock.pid' % name
        if os.path.isfile(pidfile):
            ret = False
        else:
            file(pidfile, 'w').write(pid)
            ret = True
    except Exception, e:
        return False, 'Error getting lock : %s' % str(e)
    else:
        return ret, None


def release_lock(name):
    """Used as a soft way to signal to others that this file is in no longer in use."""
    try:
        pidfile = '/tmp/integralstor_%s_lock.pid' % name
        try:
            os.unlink(pidfile)
        except Exception, e:
            pass
    except Exception, e:
        return False, 'Error releasing lock : %s' % str(e)
    else:
        return True, None

# vim: tabstop=8 softtabstop=0 expandtab ai shiftwidth=4 smarttab
